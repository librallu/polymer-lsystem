<html><head><link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">


</head><body><dom-module id="l-system">


  <template>

    <style>
      :host {
        display: block;
        width: 100%;
        margin: 0;
        padding: 0;
      }

      #lsystem {
        display: block;
        background-color: #ccc;
        margin: auto;
      }

      paper-button {
        background-color: var(--app-primary-color);
        color: white;
        display: block;
        width: 200px;
        margin: auto;
        margin-top: 10px;
        text-align: center;
        font-weight: bold;
      }

      paper-input {
        width: 80%;
        margin: auto;
      }

      canvas {
      }
    </style>

  <div id="container"><canvas id="lsystem" width="500px" height="500px"></canvas><div>
  <paper-button id="generate">GENERATE</paper-button>
  <paper-button id="reset">RESET</paper-button>
  <paper-input label="axiom" value="{{axiom}}"></paper-input>
  <paper-input label="angle" value="{{angle}}" auto-validate="" pattern="[0-9]*" error-message="digits only!"></paper-input>
  <paper-input label="initial x" value="{{xinit}}" auto-validate="" pattern="[0-9]*" error-message="digits only!"></paper-input>
  <paper-input label="initial y" value="{{yinit}}" auto-validate="" pattern="[0-9]*" error-message="digits only!"></paper-input>
  <paper-input label="Delta" value="{{delta}}" auto-validate="" pattern="[0-9]*" error-message="digits only!"></paper-input>
  <paper-input label="Rule for F" value="{{ruleF}}"></paper-input>
  <paper-input label="Rule for f" value="{{rulef}}"></paper-input>
  <paper-input label="Rule for G" value="{{ruleG}}"></paper-input>

  </div></div></template>

  <script>Polymer({is:"l-system",properties:{axiom:{type:String,value:"F"},sentence:{type:String},ruleF:{type:String,value:"FF+[+F-F-F]-[-F+F+F]"},rulef:{type:String,value:""},ruleG:{type:String,value:"FGF"},angle:{type:Number,value:20},delta:{type:Number,value:10},xinit:{type:Number,value:250},yinit:{type:Number,value:250}},applyRules:function(){for(var t="",e=0;e<this.sentence.length;e++)switch(this.sentence.charAt(e)){case"F":t+=this.ruleF;break;case"G":t+=this.ruleG;break;case"f":t+=this.rulef;break;default:t+=this.sentence.charAt(e)}this.sentence=t},ready:function(){this.generate_button=this.querySelector("#generate");var t=this;return this.generate_button.onclick=function(){t.applyRules(),t.drawResult()},this.reset_button=this.querySelector("#reset"),this.reset_button.onclick=function(){t.resetDraw()},this.canvas=this.querySelector("#lsystem"),this.canvas?(this.context=this.canvas.getContext("2d"),this.context?(window.addEventListener("resize",function(){t.windowResize()}),void this.resetDraw()):void alert("Impossible to retrieve canvas's context")):void alert("Impossible to retrieve canvas element...")},windowResize:function(){this.canvas.width=this.offsetWidth},resetDraw:function(){this.sentence=this.axiom,this.drawResult()},drawResult:function(){function t(t){var e=2*t*Math.PI/360,s=Math.cos(e)*dx-Math.sin(e)*dy,i=Math.sin(e)*dx+Math.cos(e)*dy;dx=s,dy=i}this.context.clearRect(0,0,this.canvas.width,this.canvas.height),dx=0,dy=-1;var e=Number.parseInt(this.xinit),s=Number.parseInt(this.yinit);this.context.beginPath(),this.context.lineWidth=1,this.context.moveTo(e,s),stack=[];for(var i=0;i<this.sentence.length;i++)switch(this.sentence.charAt(i)){case"F":case"G":this.context.moveTo(e,s),e+=dx*this.delta,s+=dy*this.delta,this.context.lineTo(e,s);break;case"f":e+=dx*this.delta,s+=dy*this.delta;break;case"+":t(this.angle);break;case"-":t(-this.angle);break;case"[":stack.push({dx:dx,dy:dy,x:e,y:s});break;case"]":var n=stack.pop();dx=n.dx,dy=n.dy,e=n.x,s=n.y}this.context.stroke()}});</script>

</dom-module>
</body></html>